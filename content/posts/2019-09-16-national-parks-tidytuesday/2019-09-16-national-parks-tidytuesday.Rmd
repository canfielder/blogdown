---
title: 'National Parks #TidyTuesday!'
author: 'Evan Canfield'
date: '2019-09-16'
slug: tidy-tuesday-38
categories: []
tags:
  - tidy.tuesday
draft: yes
---

# Racing Bar Chart!!!

For #tidytuesday we're looking at America's National Parks! I have already blogged about how much I love the [Nation Park System](https://evancanfield.netlify.com/posts/2019-08-30-america-s-best-idea-national-parks/national-park-visuals/), so this is perfect. My goal is to create a racing bar chart to see which National Park sites have been the most popular since 1904. 

## Libraries
```{r library calls, message=FALSE, warning=FALSE}
if (!require(pacman)) {install.packages('pacman')} 
p_load(
    gganimate
  , janitor
  , skimr
  , stringr
  , tidyverse
  , lubridate
  )
```

## Import Data
Instead of using the #TidyTuesday data set file, since I have already been exploring the National Park Visitor data, I will use the data I've already gathered. The full public data can be found (here)<https://bit.ly/2kDr64y>. I also have imported a color palette based on the National Park passports. The passports break the country down into color coded regions. I plan to apply the regional colors to each park in the racing bar chart. 

```{r data import}
# NPS Visitors
nps_summary_raw <- read.csv("./data/annual_summary_report_1904-2018.csv",
                        stringsAsFactors = FALSE)

# NPS Region Color Table
nps_region_colors <- read.csv("./data/nps_region_colors.csv",
                              stringsAsFactors = FALSE)
```

## Data Prep
AThe only important data is the park name, the year, and the number of visitors. So the data set can be greatly pared down. The park name should be treated as a factor. Also, as a side note, I like a consistent case and labeling structure, so I use the janitor package to clean the variable names

```{r data cleaning}
nps_summary <- nps_summary_raw %>% 
  clean_names() %>% 
  select(park_name, year, recreation_visitors) %>% 
  mutate(park_name = as.factor(park_name))

#glimpse(nps_summary)
#skim(nps_summary)
```
The racing bar chart will show the top park sites for each year. To visualize this I need to rank each park by population for each year. I will then filter the data by rank in order to only show the number of sites I decide to use.
```{r rank}
#Number of parks to show on the bar chart
number_of_parks <- 25

#Create annual rank and filter by number of parks
nps_summary_rank <- nps_summary %>% 
  group_by(year) %>% 
  mutate(rank = rank(-recreation_visitors)) %>% 
  ungroup() %>% 
  filter(rank <= number_of_parks)

# Generate list of top n ranked parks
nps_summary_rank_park_list <- nps_summary_rank %>% 
  distinct(park_name)

## Export Top N list for generating a cross reference of parks and regions
# write.csv(x = nps_summary_rank_park_list,
#           file = "./data/nps_parks_top_n.csv", 
#           row.names = FALSE)
```

## Racing Bar Chart
To create a racing bar chart with R I will use gganimate. First I like to set up a function for the theme and other design parameters.
```{r theme function}
# Font Info
my_font <- 'Quicksand'

# Theme Parameters
theme_racing_bar <- function(){
  theme_minimal() +
    theme(
      axis.title.y = element_blank(),
      axis.text.y = element_blank(),
      panel.grid = element_blank()
    )
}
```

With that established the animation can be created.
```{r}
# Create gganimate object
nps_racing_bar <- 
  ggplot(
    data = nps_summary_rank,
    mapping = aes(
      x = -rank,
      y = recreation_visitors,
      group = park_name
         )
    ) +
  geom_tile(
    mapping = aes(
      y = recreation_visitors/2,
      height = recreation_visitors
    )
  ) +
  # geom_text(
  #   aes(
  #     x = -number_of_parks * 0.7,
  #     y = max(recreation_visitors),
  #     label = paste0(year)
  #     ),
  #   size = 20
  #   ) +
  scale_y_continuous(
    labels=scales::comma
    ) +
  coord_flip(clip = "off") + 
  ylab(label = "Visitors") +
  labs(title = "Most Visited National Park Site") +
  theme_racing_bar() +
  transition_time(time = year)
  #ease_aes('cubic-in-out') +
  #view_follow(fixed_y = TRUE)


## Animate Plot
animate(
  plot = nps_racing_bar,
  nframes = 750,
  fps = 25,
  end_pause = 50
)

#nps_racing_bar
```

